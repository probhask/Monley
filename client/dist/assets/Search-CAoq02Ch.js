import{r as g,j as e,u as B,a as y,b as M,g as b,_ as C,A as O,c as $,F as z,d as K,e as j,f as N,B as P,s as _,h as U,i as G,I as H,k as J,S as Q,l as W,L as X,m as Y}from"./index-B8FH_rLS.js";const Z=({label:t,min:n,max:r,defaultValueMin:s,defaultValueMax:c})=>{const[l,a]=g.useState(s||n),[i,u]=g.useState(c||r);return e.jsxs("div",{className:"flex justify-center",children:[e.jsx("label",{className:"cursor-pointer min-w-32",children:e.jsx("span",{className:"label-text capitalize",children:t})}),e.jsxs("div",{className:"flex items-center relative w-[150px] gap-x-3",children:[e.jsx("input",{type:"number",name:"min",min:n,max:i-1,value:l,onChange:m=>a(Number(m.target.value)),className:"w-14 h-5 defNone text-sm border border-black text-center"}),e.jsx("p",{className:"font-bold",children:"-"}),e.jsx("input",{type:"number",name:"max",min:l,max:r,value:i,onChange:m=>u(Number(m.target.value)),className:"w-14 h-5 defNone text-sm border border-black  text-center"})]})]})},k=({label:t,list:n,name:r,defaultValue:s})=>e.jsxs("div",{className:"flex",children:[e.jsx("label",{htmlFor:r,className:"w-full",children:e.jsx("span",{className:"capitalize",children:t})}),e.jsx("select",{name:r,id:r,className:"w-full h-7 cursor-pointer",defaultValue:s,children:n.map(c=>e.jsx("option",{value:c,children:c},c))})]}),v=(t,n)=>{const r=[];for(let s=t;s<=n;s++)r.push(s);return r},ee=(t,n,r)=>{if(5+r>=t)return v(1,t);const c=Math.max(n-r,1),l=Math.min(n+r,t),a=c>2,i=l<t-2;if(!a&&i){const u=2+r;return[...v(1,u+1),"...",t]}else if(a&&!i){const u=2+r;return[1,"...",...v(t-u,t)]}else return[1,"...",...v(c,l),"...",t]},T=()=>{const[t,n]=B(),r=y(o=>o.search.totalPage),s=M(),c=()=>t.get("query")||"",l=()=>Number(t.get("page"))||1,a=()=>{if(Number(window.location.search.slice(1).split("=")[2])){const o=window.location.search.slice(1).split("=")[1].split("&")[0];s(b({searchTerm:o,page:1}))}},i=()=>{l()!==1?(n(o=>(o.set("query",t.get("query")||""),o.set("page",(l()-1).toString()||"1"),o),{replace:!0}),s(b({searchTerm:t.get("query")||"",page:Number(t.get("page"))}))):C.success("no page back",{icon:e.jsx(O,{})})},u=()=>{l()===r?C.success("last page"):(n(o=>(o.set("query",t.get("query")||""),o.set("page",(l()+1).toString()||"1"),o),{replace:!0}),s(b({searchTerm:t.get("query")||"",page:l()})))},m=o=>{n(f=>(f.set("query",o),f.set("page","1"),f),{replace:!0})},d=()=>{s(b({searchTerm:c()})),window.history.pushState(null,"",`?query=${t.get("query")||""}&page=1`)},p=o=>{s(b({searchTerm:c(),page:o})),n(f=>(f.set("page",o.toString()),f),{replace:!0})},x=ee(r,l(),1);return g.useEffect(()=>(window.addEventListener("popstate",a),()=>window.removeEventListener("popstate",a)),[]),{nextPage:u,previousPage:i,getSearchData:a,setSearchTerm:m,search:d,getCurrentPage:l,getSearchTerm:c,pageSearch:p,paginateButtonArray:x}},te=({totalPage:t})=>{const{previousPage:n,nextPage:r,getCurrentPage:s,pageSearch:c,paginateButtonArray:l}=T();return e.jsxs("div",{className:"flex gap-x-5",children:[e.jsx("button",{className:"px-2 py-0.5 bg-orange-700 hover:bg-orange-600 text-white flex justify-center items-center gap-x-1",onClick:n,children:"prev"}),t!==0&&e.jsx("div",{className:"flex",children:l.map((a,i)=>e.jsx("button",{className:`w-6 h-full flex justify-center items-center text-orange-400 border border-orange-400 cursor-pointer font-bold ${s()===a?"bg-orange-400 text-white":""}`,disabled:typeof a=="string",onClick:()=>typeof a=="number"&&c(a),children:a},i))}),e.jsx("button",{className:"px-2 py-0.5 bg-orange-700 hover:bg-orange-600 text-white flex justify-center items-center gap-x-1",onClick:r,children:"next"})]})},se=({filterFalse:t})=>{const n=$(t),{search:r,getSearchTerm:s}=T(),[c]=g.useState(["all","shirt","tshirt","top","studs"]),l=i=>{if(i.preventDefault(),s()){const u=new FormData(i.target),m=u.get("category"),d=u.get("order"),p=u.get("gender"),x=u.get("min"),o=u.get("max");console.log(m,d,p,x,o),_({category:m,order:d,gender:p,minPrice:x,maxPrice:o}),r(),t()}else C.error("please provide search term")},a=()=>{U(),r(),window.location.reload()};return e.jsx("div",{className:"absolute top-0 z-10",ref:n,children:e.jsxs(z,{className:"relative bg-gray-50 rounded-md px-8 py-4",onSubmit:l,onReset:a,children:[e.jsx("div",{className:"absolute right-2 top-2 w-fit",onClick:()=>t(),children:e.jsx(K,{className:"text-black cursor-pointer"})}),e.jsxs("div",{className:"grid gap-x-4 gap-y-8 grid-cols-1  text-black justify-center items-center",children:[e.jsx(k,{label:"select category",name:"category",list:c,defaultValue:j()&&N("category")||"all"}),e.jsx(k,{label:"sort by",name:"order",list:["asec","desc"],defaultValue:j()&&N("order")||"asec"}),e.jsx(k,{label:"select gender",name:"gender",list:["all","male","female"],defaultValue:j()&&N("gender")||"all"}),e.jsx(Z,{label:"price range",min:300,max:5e3,defaultValueMin:j()&&Number(N("minPrice"))||500,defaultValueMax:j()&&Number(N("maxPrice"))||5e3})]}),e.jsxs("div",{className:"flex justify-center gap-x-3 mt-8",children:[e.jsx(P,{type:"submit",text:"Filter",classes:"w-full bg-orange-700 hover:bg-orange-600 text-white"}),e.jsx(P,{type:"reset",text:"Reset",classes:"w-full bg-orange-700 hover:bg-orange-600 text-white"})]})]})})},re=()=>{const[t,n]=g.useState(!1),r=()=>{n(!1)},s=()=>{n(!0)};return e.jsxs("div",{className:"relative flex justify-end w-[80%]",children:[e.jsxs("div",{className:"flex items-center gap-x-2 font-semibold bg-gray-200 px-2 py-0.5 cursor-pointer hover:scale-105 self-end text-black",onClick:s,children:[e.jsx(G,{className:"text-gray-500"}),"Filter"]}),t&&e.jsx(se,{filterFalse:r})]})},ae=({onSubmitFunc:t,onKeyUp:n,setValue:r,value:s,onFocus:c,onBlur:l})=>e.jsx("form",{className:"max-w-full",onSubmit:t,children:e.jsxs("div",{className:"flex justify-center h-10",children:[e.jsx("div",{className:"flex items-center border-2  px-4 bg-white  w-full",children:e.jsx("input",{type:"text",name:"search",value:s,className:"outline-none focus:outline-none px-2 text-gray-600 font-semibold w-full",placeholder:"search here...",onChange:r,autoComplete:"off",onFocus:c,onBlur:l,onKeyUp:n})}),e.jsxs("button",{type:"submit",className:"px-2 py-0.5 bg-orange-700 hover:bg-orange-600 text-white flex justify-center items-center gap-x-1",children:[e.jsx(H,{}),e.jsx("p",{className:"hidden sm:block",children:"search"})]})]})}),ne=()=>{const{setSearchTerm:t,search:n,getSearchTerm:r}=T(),[s,c]=g.useState(r()),[l,a]=g.useState(!1),[i,u]=g.useState(-1),m=g.useRef(null),[d,p]=g.useState([]),[x,o]=g.useState(""),[f,F]=g.useState(!1),E=J(),R=()=>{s.length>0&&a(!0)},w=()=>{a(!1)},A=h=>{i<d.length?h.key==="ArrowUp"&&i>0?u(S=>S-1):h.key==="ArrowDown"&&i<d.length-1?u(S=>S+1):h.key==="Enter"&&i>=0?i>-1&&(t(d[i].item_name),I(d[i].productId),w()):h.key==="Escape"&&w():u(-1)},D=h=>{h.preventDefault(),s.length>=1&&(t(s),n(),w())},q=h=>{c(h.target.value),R()},I=h=>{E(`/shop/product/${h}`)},L=async h=>{F(!0),o("");try{const V=await(await W.get("http://localhost:3000/search/suggestion",{params:{searchTerm:h}})).data.search;p(V||[])}catch(S){o(S)}finally{F(!1)}};return g.useEffect(()=>{x&&console.error(x)},[x]),g.useEffect(()=>{const h=setTimeout(()=>{s.length>0?L(s):p([])},500);return()=>clearInterval(h)},[s]),g.useEffect(()=>{c(r())},[r()]),e.jsxs("div",{className:"bg-gray-100 w-[80%] md:w-[60%] lg-w[50%] flex flex-col justify-center relative my-3",children:[e.jsx(ae,{value:s,setValue:q,onSubmitFunc:D,onKeyUp:A,onFocus:R,onBlur:w}),s&&l&&e.jsx(Q,{selectedSuggestion:i,suggestions:d,highLighText:s,onSelect:I,ref:m}),f&&e.jsx("div",{className:"mx-auto",children:"loading.."})]})},ce=()=>{const t=y(a=>a.search.data),n=y(a=>a.search.isSearching),r=y(a=>a.search.isError),s=y(a=>a.search.totalPage),c=y(a=>a.search.totalResult),l=y(a=>a.search.limit);return{searchItems:t,isSearching:n,searchError:r,searchTotalPage:s,searchTotalResult:c,searchLimit:l}},oe=()=>{const{getSearchData:t,getSearchTerm:n}=T(),{searchItems:r,searchTotalPage:s,isSearching:c}=ce();return g.useEffect(()=>{n()&&t()},[]),e.jsxs("div",{className:"flex flex-col flex-wrap justify-center items-center my-5 gap-y-2",children:[e.jsx(ne,{}),e.jsx(re,{}),c&&e.jsx(X,{}),!c&&s===0&&e.jsx("div",{className:"my-10 font-semibold",children:"No product found"}),r&&e.jsx("div",{className:`grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-x-2 gap-y-3 mb-5
        `,children:r.map((l,a)=>e.jsx(Y,{item:l},a))}),s>0&&e.jsx(te,{totalPage:s})]})};export{oe as Search,oe as default};
